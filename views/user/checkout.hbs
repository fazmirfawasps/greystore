<!DOCTYPE html>
<html lang="en">

<head>
  <title>ShopMax &mdash; Colorlib e-Commerce Template</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mukta:300,400,700">
  <link rel="stylesheet" href="/fonts/icomoon/style.css">

  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/magnific-popup.css">
  <link rel="stylesheet" href="/css/jquery-ui.css">
  <link rel="stylesheet" href="/css/owl.carousel.min.css">
  <link rel="stylesheet" href="/css/owl.theme.default.min.css">




  <link rel="stylesheet" href="/css/aos.css">

  <link rel="stylesheet" href="/css/style.css">

</head>

<body onload="my('{{totalamount}}','{{wall}}')">

  {{>userHead}}

  <div class="bg-light py-3">
    <div class="container">
      <div class="row">
        <div class="col-md-12 mb-0"><a href="index.html">Home</a> <span class="mx-2 mb-0">/</span> <a
            href="cart.html">Cart</a> <span class="mx-2 mb-0">/</span> <strong class="text-black">Checkout</strong>
        </div>
      </div>
    </div>
  </div>

  <div class="site-section">
    <div class="container">
      <form id="form1">

        <div class="row">


          <div class="col-md-6 mb-5 mb-md-0">
            <h2 class="h3 mb-3 text-black">Billing Details</h2>
            {{#if response}}
            {{#each response}}

            <div class="border p-2 rounded" role="alert">
              <input type="checkbox" name="defaultAddress" id="checkbox" onclick="dis()" value="{{this._id}}">
              <label for="default address" style="color:#ee4266 ;">defaultAddress</label>
              <p>Name:{{this.name}}<br>
                Address:{{this.address}},
                {{this.city}}
                ,{{this.pincode}}
                <br>{{this.email}}
                <br>mob no:{{this.phone}}
              </p>
              <div>
                <a href="/users/editad?id={{this._id}}" class="btn btn-danger">edit</a>
                <a href="/users/manageAddress" class="btn btn-secondary ml-2">change address </a>


              </div>





            </div>


            {{/each}}
            {{/if}}



            <p>
              <a class="btn btn-primary mt-3" data-toggle="collapse" href="#collapseExample" role="button"
                aria-expanded="false" aria-controls="collapseExample" onclick="able()">
                Add new address
              </a>

            </p>
            <div class="collapse" id="collapseExample">
              <div class="card card-body">
                <div class="p-3 p-lg-5 border">

                  <div class="form-group">
                    <label for="c_country" class="text-black">Country <span class="text-danger">*</span></label>
                    <select id="country" class="form-control" name="country" required>
                      <option value="1">Select a country</option>
                      <option value="2">india</option>

                      <option value="3">Algeria</option>
                      <option value="4">Afghanistan</option>
                      <option value="5">Ghana</option>
                      <option value="6">Albania</option>
                      <option value="7">Bahrain</option>
                      <option value="8">Colombia</option>
                      <option value="9">Dominican Republic</option>
                    </select>
                  </div>
                  <div class="form-group row">
                    <div class="col-md-12">
                      <label for="c_name" class="text-black">Full Name </label>
                      <input type="text" class="form-control" id='name' name="name" oninput="namevalidation()" required>
                    </div>
                    <div>
                      <span id="name-error" style="color:red ;"></span>
                    </div>
                  </div>


                  <div class="form-group row">
                    <div class="col-md-12">
                      <label for="c_companyname" class="text-black">Company Name </label>
                      <input type="text" class="form-control" id="companyname" name="companyname">
                    </div>
                  </div>

                  <div class="form-group row">
                    <div class="col-md-12">
                      <label for="c_address" class="text-black">Address <span class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="address" name="address" placeholder="Street address">
                    </div>
                  </div>

                  <div class="form-group">
                    <input type="text" class="form-control" placeholder="Apartment, suite, unit etc. (optional)">
                  </div>

                  <div class="form-group row">
                    <div class="col-md-6">
                      <label for="c_state_country" class="text-black">State / Country <span
                          class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="state" name="city" required>
                    </div>
                    <div class="col-md-6">
                      <label for="c_postal_zip" class="text-black">Posta / Zip <span
                          class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="pincode" name="pincode" required>
                    </div>
                  </div>

                  <div class="form-group row mb-5">
                    <div class="col-md-6">
                      <label for="c_email_address" class="text-black">Email Address <span
                          class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="email" oninput="validateEmail()" name="email"
                        required>
                      <span id="email-error" style="color:red ;"></span>

                    </div>

                    <div class="col-md-6">
                      <label for="c_phone" class="text-black">Phone <span class="text-danger">*</span></label>
                      <input type="text" class="form-control" id="phone" name="phone" oninput="validateMobile()"
                        required>
                      <span id="mobile-error" style="color:red ;"></span>

                    </div>

                  </div>
                  {{!-- <div class="form-group row mb-5">
                    <div class="col-md-6">
                      <span id="email-error" style="color:red ;"></span>
                    </div>
                    <div class="col-md-6">
                    </div>
                  </div> --}}


                  <div class="form-group">
                    <label for="c_order_notes" class="text-black">Order Notes</label>
                    <textarea name="message" id="c_order_notes" cols="30" rows="5" class="form-control"
                      placeholder="Write your notes here..."></textarea>
                  </div>

                </div>
              </div>
            </div>
          </div>



          <div class="col-md-6">



            <div class="row mb-5">
              <div class="col-md-12">
                <h2 class="h3 mb-3 text-black">Your Order</h2>
                <div class="p-3 p-lg-5 border">
                  <table class="table site-block-order-table mb-5">
                    <thead>
                      <th>Product</th>
                      <th>Total</th>
                    </thead>
                    <tbody>
                      {{#each product}}
                      <tr>
                        <td>{{this.products.name}} <strong class="mx-2">x</strong> {{this.count}}</td>
                        <td>{{this.totalprice}}</td>
                      </tr>
                      {{/each}}

                      <tr>
                        <td class="text-black font-weight-bold"><strong>Cart Subtotal</strong></td>
                        <td class="text-black">{{totalamount}}</td>
                      </tr>
                      <tr>

                        <td class="text-black font-weight-bold"><strong>Order Total</strong></td>
                        <td class="text-black font-weight-bold"><strong>{{totalamount}}</strong></td>
                      </tr>
                    </tbody>
                  </table>

                  <div class="border p-3 mb-3">
                    <input type="radio" name="payment" value="COD">
                    <label for="" style="color:#ee4266 ;">Cash On Delivery</label>

                    <div class="collapse" id="collapsebank">
                      <div class="py-2">
                        <p class="mb-0">Make your payment directly into our bank account. Please use your Order ID as
                          the payment reference. Your order won’t be shipped until the funds have cleared in our
                          account.</p>
                      </div>
                    </div>
                  </div>

                  <div class="border p-3 mb-3">
                    <input type="radio" name="payment" value="RazorPay">
                    <label for="" style="color:#ee4266 ;">RazorPay</label>
                    <div class="collapse" id="collapsecheque">
                      <div class="py-2">
                        <p class="mb-0">Make your payment directly into our bank account. Please use your Order ID as
                          the payment reference. Your order won’t be shipped until the funds have cleared in our
                          account.</p>
                      </div>
                    </div>
                  </div>
                  <div class="border p-3 mb-3">
                    <input type="radio" name="payment" value="payPal">
                    <label for="" style="color:#ee4266 ;">payPal</label>
                    <div class="collapse" id="collapsecheque">
                      <div class="py-2">
                        <p class="mb-0">Make your payment directly into our bank account. Please use your Order ID as
                          the payment reference. Your order won’t be shipped until the funds have cleared in our
                          account.</p>
                      </div>
                    </div>
                  </div>

                  <div class="border p-3 mb-3">
                    <input type="radio" name="payment" value="wallet" id="wallet">
                    <label for="" style="color:#ee4266 ;">wallet</label>
                    <div class="collapse" id="collapsecheque">
                      <div class="py-2">
                        <p class="mb-0">Make your payment directly into our bank account. Please use your Order ID as
                          the payment reference. Your order won’t be shipped until the funds have cleared in our
                          account.</p>
                      </div>
                    </div>
                  </div>



                  <div class="form-group">
                    <button class="btn btn-primary btn-lg btn-block" type="submit">Place Order</button>
                  </div>

                </div>
              </div>
            </div>

          </div>
        </div>
      </form>
    </div>
  </div>

  <footer class="site-footer custom-border-top">
    <div class="container">
      <div class="row">
        <div class="col-md-6 col-lg-3 mb-4 mb-lg-0">
          <h3 class="footer-heading mb-4">Promo</h3>
          <a href="#" class="block-6">
            <img src="/images/about_1.jpg" alt="Image placeholder" class="img-fluid rounded mb-4">
            <h3 class="font-weight-light  mb-0">Finding Your Perfect Shirts This Summer</h3>
            <p>Promo from July 15 &mdash; 25, 2019</p>
          </a>
        </div>
        <div class="col-lg-5 ml-auto mb-5 mb-lg-0">
          <div class="row">
            <div class="col-md-12">
              <h3 class="footer-heading mb-4">Quick Links</h3>
            </div>
            <div class="col-md-6 col-lg-4">
              <ul class="list-unstyled">
                <li><a href="#">Sell online</a></li>
                <li><a href="#">Features</a></li>
                <li><a href="#">Shopping cart</a></li>
                <li><a href="#">Store builder</a></li>
              </ul>
            </div>
            <div class="col-md-6 col-lg-4">
              <ul class="list-unstyled">
                <li><a href="#">Mobile commerce</a></li>
                <li><a href="#">Dropshipping</a></li>
                <li><a href="#">Website development</a></li>
              </ul>
            </div>
            <div class="col-md-6 col-lg-4">
              <ul class="list-unstyled">
                <li><a href="#">Point of sale</a></li>
                <li><a href="#">Hardware</a></li>
                <li><a href="#">Software</a></li>
              </ul>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-lg-3">
          <div class="block-5 mb-5">
            <h3 class="footer-heading mb-4">Contact Info</h3>
            <ul class="list-unstyled">
              <li class="address">203 Fake St. Mountain View, San Francisco, California, USA</li>
              <li class="phone"><a href="tel://23923929210">+2 392 3929 210</a></li>
              <li class="email">emailaddress@domain.com</li>
            </ul>
          </div>

          <div class="block-7">
            <form action="#" method="post">
              <label for="email_subscribe" class="footer-heading">Subscribe</label>
              <div class="form-group">
                <input type="text" class="form-control py-4" id="email_subscribe" placeholder="Email">
                <input type="submit" class="btn btn-sm btn-primary" value="Send">
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="row pt-5 mt-5 text-center">
        <div class="col-md-12">
          <p>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;
            <script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with
            <i class="icon-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank"
              class="text-primary">Colorlib</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
          </p>
        </div>

      </div>
    </div>
  </footer>
  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Edit address</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="addedit">
            <div class="form-group">
              <label for="recipient-name" class="col-form-label">Recipient:</label>
              <input type="text" class="form-control" id="recipient-name">
            </div>
            <div class="form-group">
              <label for="message-text" class="col-form-label">Message:</label>
              <textarea class="form-control" id="message"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onclick="hello()">Save </button>
        </div>
      </div>
    </div>
  </div>

  </div>
  <script>
    function dis() {
      document.getElementById('country').disabled = true
      document.getElementById('name').disabled = true
      document.getElementById('state').disabled = true
      document.getElementById('pincode').disabled = true
      document.getElementById('phone').disabled = true
      document.getElementById('email').disabled = true
      if (document.getElementById('checkbox').checked) {

      }
      else {
        able()
      }
    }
    function able() {
      console.log('oooooo')
      document.getElementById('checkbox').checked = false

      document.getElementById('country').disabled = false
      document.getElementById('name').disabled = false
      document.getElementById('state').disabled = false
      document.getElementById('pincode').disabled = false
      document.getElementById('phone').disabled = false
      document.getElementById('email').disabled = false


    }
  </script>

  <script src="/js/formvalidation.js"></script>
  <script src="/js/jquery-3.3.1.min.js"></script>
  <script src="/js/jquery-ui.js"></script>
  <script src="/js/popper.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/owl.carousel.min.js"></script>
  <script src="/js/jquery.magnific-popup.min.js"></script>
  <script src="/js/aos.js"></script>
  <script src="/js/validation.js"></script>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>



  <script src="/js/main.js"></script>
  <script>
    function my(amount, wallet) {
      if (0 > Math.round(wallet - amount)) {
        document.getElementById('wallet').disabled = true;

      }
      else {

      }


    }
  </script>
  <script>
    $("#form1").submit((e) => {
      e.preventDefault()
      $.ajax({
        url: '/users/checkout',
        method: 'post',
        data: $('#form1').serialize(),
        success: (response) => {
          if (response.codSucess) {
            location.href = "/users/ordersucess"
          }
          else if (response.unkonwn) {
            razorPayment(response)
          }
          else {
            location.href = response.href

          }


        }
      })
    })



    function razorPayment(order) {
      var options = {
        "key": "rzp_test_BwNiRbvUN9pfdI", // Enter the Key ID generated from the Dashboard
        "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
        "currency": "INR",
        "name": "Grey store",
        "description": "Test Transaction",
        "image": "https://example.com/your_logo",
        "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
        "handler": function (response) {
          verifyPayment(response, order)
        },
        "prefill": {
          "name": "Gaurav Kumar",
          "email": "gaurav.kumar@example.com",
          "contact": "9999999999"
        },
        "notes": {
          "address": "Razorpay Corporate Office"
        },
        "theme": {
          "color": "#3399cc"
        },
        modal: {
          ondismiss: function () {
            $.ajax({
              url: "/users/onfailure",
              data: {
                orderid: order,
              },
              method: "delete",
              success: (response) => {
                if (response.status) {
                  Swal.fire({
                    icon: "error",
                    title: "Oops...",
                    text: "Paymnet Cancelled",
                    buttons: false,
                    timer: 1500,
                  }).then(() => {
                    location.reload()
                  })

                }
              },
            });
          },
        },
      };
      var rzp1 = new Razorpay(options);
      rzp1.on("payment.failed", function (response) {
        rzp1.close();
      })
      rzp1.open()
    }


    function verifyPayment(payment, order) {
      $.ajax({
        url: '/users/verify-payment',
        data: {
          payment,
          order
        },
        method: "post",
        success: (response) => {
          if (response.status) {
            location.href = "/users/ordersucess"
          }
          else {
            Swal.fire({
              icon: 'error',
              title: 'Oops...',
              text: 'Something went wrong!',
            })
          }
        }
      })
    }



  </script>






</body>

</html>